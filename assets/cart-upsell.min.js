!function(){const settings={cartType:window.themeVariables.settings.cartType},selectors={addonSection:".dbtfy-cart-upsell",upsell:".dbtfy-cart-upsell-item",generalUpsell:".dbtfy-cart-upsell-item--general",specificUpsell:".dbtfy-cart-upsell-item--specific",form:".dbtfy-cart-upsell-item__form",image:".dbtfy-cart-upsell-item__image",variantsSelect:".dbtfy-cart-upsell-item__variants",button:".dbtfy-cart-upsell-item__button",quantity:".dbtfy-cart-upsell-item__quantity"},classes={enabledAddon:"dbtfy-cart-upsell-enabled",addonSection:"dbtfy-cart-upsell",upsell:"dbtfy-cart-upsell-item",generalUpsell:"dbtfy-cart-upsell-item--general",replaceUpsell:"dbtfy-cart-upsell-item--replace"},section=(document.body.classList.add(classes.enabledAddon),document.querySelector(selectors.addonSection));function init(e){e.items.length&&(removeExistingUpsells(),initGeneralUpsell(e),initSpecificUpsell(e),attachEventListeners(),theme.ajaxCart.init(),theme.imagesLazyLoading())}function initGeneralUpsell(r){var e=section.querySelectorAll(selectors.generalUpsell);e.length&&r&&(e=Array.from(e).filter(e=>{e=theme.helpers.safelyParseJson(e.dataset.blockSettings);if(e){const t=e.productId;return!r.items.some(e=>e.product_id===t)}})).length&&e.forEach(e=>{let t;"drawer"===settings.cartType?t="#CartDrawer":"modal"===settings.cartType&&(t="#CartModal");var r=document.querySelector(t+" .drawer__inner"),r=(r&&((a=(s=e.cloneNode(!0)).querySelector("form"))&&(a.removeAttribute("data-has-submit-event"),a.removeAttribute("data-has-submit-listener")),r.querySelector(selectors.generalUpsell)||r.insertAdjacentHTML("beforeend",`
            <div class="${classes.addonSection} drawer__inner-section card-group"></div>
          `),a=r.querySelector(selectors.addonSection))&&a.insertAdjacentElement("beforeend",s),document.querySelector(".cart-page .cart__main"));if(r){var a=e.cloneNode(!0),s=a.querySelector("form");s&&(s.removeAttribute("data-has-submit-event"),s.removeAttribute("data-has-submit-listener"));const settings=theme.helpers.safelyParseJson(e.dataset.blockSettings);settings&&(s=settings.productId,r.insertAdjacentHTML("beforeend",`
          <div class="${classes.addonSection} mt-3" data-product-id="${s}"></div>
        `),e=r.querySelector(selectors.addonSection+`[data-product-id="${s}"]`))&&e.insertAdjacentElement("beforeend",a)}})}function initSpecificUpsell(r){var e=section.querySelectorAll(selectors.specificUpsell);if(e.length&&r){const a=Array.from(e).filter(e=>{e=theme.helpers.safelyParseJson(e.dataset.blockSettings);if(e){const t=e.productOfferId;return!r.items.some(e=>e.product_id===t)}});a.length&&r.items.forEach((e,l)=>{const t=e.product_id;e=a.filter(e=>{var e=theme.helpers.safelyParseJson(e.dataset.blockSettings);if(e)return e=e.productTriggerId,t===e});if(e.length){const r=[];e.filter(e=>{var e=theme.helpers.safelyParseJson(e.dataset.blockSettings);if(e)return e=e.productOfferId,!r.includes(e)&&(r.push(e),!0)}).forEach(e=>{let t;"drawer"===settings.cartType?t="#CartDrawer":"modal"===settings.cartType&&(t="#CartModal");var r,a,s=document.querySelector(t+" .drawer__inner"),s=(s&&((r=(a=e.cloneNode(!0)).querySelector("form"))&&(r.removeAttribute("data-has-submit-event"),r.removeAttribute("data-has-submit-listener")),r=s.querySelector(`.cart__item[data-line="${l+1}"]`))&&(r.querySelector(selectors.specificUpsell)||r.insertAdjacentHTML("beforeend",`
                <div class="${classes.addonSection} card-group mt-3" data-line="${l+1}"></div>
              `),r=s.querySelector(selectors.addonSection+`[data-line="${l+1}"]`))&&r.insertAdjacentElement("beforeend",a),document.querySelector(".cart-page .cart__main"));s&&((a=(r=e.cloneNode(!0)).querySelector("form"))&&(a.removeAttribute("data-has-submit-event"),a.removeAttribute("data-has-submit-listener")),e=s.querySelector(`.cart__row[data-line="${l+1}"]`))&&(e.querySelector(selectors.specificUpsell)||e.insertAdjacentHTML("beforeend",`
                <div class="${classes.addonSection}" data-line="${l+1}"></div>
              `),a=s.querySelector(selectors.addonSection+`[data-line="${l+1}"]`))&&a.insertAdjacentElement("beforeend",r)})}})}}function attachEventListeners(){document.querySelectorAll(selectors.variantsSelect).forEach(e=>{e.addEventListener("change",()=>{changeVariantImage(e),changeVariantUrl(e)})}),document.querySelectorAll(selectors.button).forEach(n=>{n.addEventListener("click",t=>{t.preventDefault();t=n.closest(selectors.upsell);const r=t.querySelector(selectors.form);let a=!1;if(theme.loadingState.init(n),t.classList.contains(classes.replaceUpsell)){var s=n.closest(".cart__row"),l=+s.dataset.line,s=s.querySelector(".product-quantity__input");let e=!1;if(s){var s=+s.value,o=t.querySelector(selectors.quantity),t=t.querySelector(selectors.variantsSelect)?.selectedOptions[0];if(!t)return;t=theme.helpers.safelyParseJson(t.dataset.blockSettings);if(!t)return;t=t.quantity;e=Boolean(s<=t),o.value=s}e&&(a=!0,theme.ShopifyAPI.changeItem(l,0,()=>{addProductToCart(r,n)}))}a||addProductToCart(r,n)})})}function addProductToCart(form,upsellButton){theme.ShopifyAPI.addItemFromForm({forms:form},e=>{theme.loadingState.destroy(upsellButton),document.body.classList.contains("dbtfy-upsell-popup-enabled")?document.dispatchEvent(new CustomEvent("theme:addon:upsell-popup:form-submitted",{detail:{form:form}})):theme.ajaxCart.update(),document.body.classList.remove("js-modal-open")},(XMLHttpRequest,textStatus,form)=>{theme.loadingState.destroy(upsellButton);const data=eval(`(${XMLHttpRequest.responseText})`);if(data.message&&422===data.status){const existedError=upsellButton.nextElementSibling;existedError&&existedError.remove(),upsellButton.insertAdjacentHTML("afterend",`<div class="errors product-quantity-error">${data.description}</div>`)}})}function changeVariantImage(e){var t=e.selectedOptions[0];t&&(t=theme.helpers.safelyParseJson(t.dataset.blockSettings))&&(t=t.imageSrc)&&(e=e.closest(selectors.upsell).querySelector(selectors.image))&&(e.setAttribute("src",t),e.setAttribute("srcset",t))}function changeVariantUrl(e){var t=e.selectedOptions[0];if(t){t=theme.helpers.safelyParseJson(t.dataset.blockSettings);if(t){const r=t.url;r&&e.closest(selectors.upsell).querySelectorAll("a").forEach(e=>{e.setAttribute("href",r)})}}}function removeExistingUpsells(){document.querySelectorAll(".cart "+selectors.upsell).forEach(e=>{e.remove()})}section&&(theme.isCartLoaded?theme.helpers.loadComponents(["ajaxCart","imagesLazyloading","loadingState"],()=>{init(theme.cart)}):document.addEventListener("theme:cart:initially-loaded",e=>{theme.helpers.loadComponents(["ajaxCart","imagesLazyloading","loadingState"],()=>{init(theme.cart)})}),document.addEventListener("theme:cart:loaded",e=>{theme.helpers.loadComponents(["ajaxCart","imagesLazyloading","loadingState"],()=>{init(e.detail.cart)})}))}();