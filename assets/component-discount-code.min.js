window.theme=window.theme||{},theme.discountCode={automatedDiscountRemoved:!1,init:function(e){this.applyAutomaticDiscounts(),this.initAutomatedDiscounts();const o=this.getStoredDiscounts();if(o.length){var n=e||null;let t=this.getMostValuableDiscount(o,theme.cart);n||(theme.isCartLoaded?t=this.getMostValuableDiscount(o,theme.cart):document.addEventListener("theme:cart:initially-loaded",()=>{(t=this.getMostValuableDiscount(o,theme.cart))&&this.applyDiscount(t.name,t.type,t.amount,theme.cart)})),t&&(this.applyDiscount(t.name,t.type,t.amount,n),theme.showTheMostValuableDiscountInCart())}else this.destroyDiscount(e)},initAutomatedDiscounts(){document.addEventListener("theme:cart:loaded",t=>{this.automatedDiscountRemoved=!1})},getMostValuableDiscount:function(e,s){if(e&&e.length){let t=e.filter(t=>!(t.role&&"product"===t.role));if((t=t.length?t:e.filter(t=>t.role&&"product"===t.role)).length)return(e=t.map((t,e)=>{var{type:t,amount:o}=t,n=s.total_price/100;let a=null;switch(t){case"%":a=n/100*o;break;case"$":a=o}return a>n?null:{index:e,value:a}}).filter(t=>t)).length?(e=(e=e.reduce((t,e)=>t.value>e.value?t:e))?e.index:0,t[e]):null}},getStoredDiscounts:function(){var t=sessionStorage.getItem("discounts");return!t||"object"!=typeof(t=JSON.parse(t))?[]:t},applyAutomaticDiscounts(){this.automatedDiscountRemoved||(this.removeAutomaticDiscounts(),this.automatedDiscountRemoved=!0),document.querySelectorAll(".cart-discount--automated .cart-discount__discount").forEach(t=>{var e=t.dataset.name,o=t.dataset.amount,n=t.dataset.role;e&&o&&(t.closest(".cart-discount--automated")?.classList.remove("cart-discount--automated"),this.addDiscount(e,"$",o,{role:n}))})},removeAutomaticDiscounts(){this.getStoredDiscounts().forEach(t=>{var e=t.name,t=t.role;!t||"product"!==t&&"cart"!==t||this.removeDiscount(e)})},applyDiscount:function(r,u,d,t,e){const l=this;var o;r&&((o=theme.helpers.getCookie("discount_code"))&&o===r?"function"==typeof e&&e():(document.cookie=`discount_code=${r}; path=/`,fetch("/discount/"+r).then(()=>{"function"==typeof e&&e(),document.dispatchEvent(new CustomEvent("theme:discount:applied"))})));const n=document.querySelectorAll("form[action*='/cart'], form[action*='/checkout']");if(n.length){let c=t||null;function a(){n.forEach(function(t){var e=t.querySelectorAll("input[name='discount']"),o=t.querySelector("[data-cart-total]"),n=t.querySelector("[data-cart-total-value]"),a=window.themeVariables.settings.moneyFormat,s=(e.length?e.forEach(t=>{t.setAttribute("value",r)}):((e=document.createElement("input")).setAttribute("type","hidden"),e.setAttribute("name","discount"),e.setAttribute("value",r),t.insertAdjacentElement("afterbegin",e)),c.original_total_price);let i=s;switch(u){case"$":i=s-100*d;break;case"%":i=s-s*(d/100)}l.getStoredDiscounts().filter(t=>t.name!==r&&t.role&&"product"===t.role).forEach(t=>{i-=100*t.amount});t=theme.Currency.formatMoney(s,a),e=theme.Currency.formatMoney(i,a);if(o){a=o.querySelectorAll(".cart__subtotal-discounted"),a=(a.length&&a.forEach(t=>{t.remove()}),o.dataset.currentTotalValue);if(a&&a===i)return;o.dataset.currentTotalValue=i,o.dataset.currentTotalCompareValue=s,o.querySelector(".cart__subtotal-compare-at")&&(o.innerHTML=""),o.innerHTML=`<span class="cart__subtotal-discounted text-sale"><span class="money">${e}</span></span> <span class="cart__subtotal-discounted text-muted text-strike"><span class="money">${t}</span></span>`}n&&(n.innerHTML=`<span class="money">${e}</span>`)}),l.triggerStorageDiscountUpdated()}c?a():theme.isCartLoaded?(c=theme.cart,a()):document.addEventListener("theme:cart:initially-loaded",()=>{c=theme.cart,a()})}},addDiscount:function(e,t,o,n){let a=this.getStoredDiscounts();if(a.length){if(a.some(t=>t.name===e)&&(this.removeDiscount(e),a=this.getStoredDiscounts()),a.push({name:e,type:t,amount:o}),"object"==typeof n)for(var[s,i]of Object.entries(n))a[a.length-1][s]=i;sessionStorage.setItem("discounts",JSON.stringify(a))}else{var c=[{name:e,type:t,amount:o}];if("object"==typeof n)for(var[r,u]of Object.entries(n))c[0][r]=u;sessionStorage.setItem("discounts",JSON.stringify(c))}this.init(),this.triggerStorageDiscountUpdated()},removeDiscount:function(e,n){var o=this.getStoredDiscounts();if(o.length){let t=!0;"object"==typeof n&&n.hasOwnProperty("needUpdate")&&(t=n.needUpdate),n&&n.needUpdate&&delete n.needUpdate;o=o.filter(o=>{let t=!0;return"object"==typeof n&&(t=Object.entries(n).every(([t,e])=>o.hasOwnProperty(t)&&o[t]===e)),!(o.name===e&&t)});sessionStorage.setItem("discounts",JSON.stringify(o)),t&&this.init(),this.triggerStorageDiscountUpdated()}},removeAllDiscountsByName:function(t,e){var o=this.getStoredDiscounts();o.length&&(o=o.filter(n=>{let t=!1;return!(t="object"==typeof e?Object.entries(e).every(([t,e])=>{let o=n[t]===e;return"object"==typeof e&&e.checkFunction&&e.checkFunction instanceof Function&&(o=e.checkFunction(n)),n.hasOwnProperty(t)&&o}):t)}),sessionStorage.setItem("discounts",JSON.stringify(o)),this.init(),this.triggerStorageDiscountUpdated())},removeAllDiscounts:function(){sessionStorage.removeItem("discounts"),this.init(),this.triggerStorageDiscountUpdated()},hasDiscount:function(e){var t=this.getStoredDiscounts();if(t.length)return t.some(t=>t.name===e)},destroyDiscount:function(t){const e=document.querySelectorAll("form[action*='/cart'], form[action*='/checkout']"),s=document.querySelectorAll("[data-cart-total]"),o=this;if(e.length){(sessionStorage.getItem("discount")?sessionStorage.getItem("discount"):null)&&sessionStorage.removeItem("discount"),document.cookie="discount_code=; path=/";let a=t||null;function n(){e.forEach(function(t){var t=t.querySelectorAll("input[name='discount']"),e=document.querySelectorAll("[data-cart-total-value]"),t=(t.forEach(t=>{t.setAttribute("value","")}),a.total_price);if(0<t){var o=window.themeVariables.settings.moneyFormat;const n=theme.Currency.formatMoney(t,o);s.length&&s.forEach(function(t){t.querySelector(".cart__subtotal-compare-at")&&(t.innerHTML=""),t.innerHTML=`<span class="money">${n}</span>`}),e.length&&e.forEach(function(t){t.innerHTML=`<span class="money">${n}</span>`})}}),o.triggerStorageDiscountUpdated()}a?n():theme.isCartLoaded?(a=theme.cart,n()):document.addEventListener("theme:cart:initially-loaded",()=>{a=theme.cart,n()})}},triggerStorageDiscountUpdated:function(){document.dispatchEvent(new CustomEvent("theme:discount:updated"))}},theme.showTheMostValuableDiscountInCart=function(){function e(t){var e=theme.discountCode.getStoredDiscounts(),o=theme.discountCode.getMostValuableDiscount(e,t),e=document.querySelectorAll(".cart__subtotal-wrapper"),n=document.querySelectorAll(".cart-discount"),a=t.items_subtotal_price,t=window.themeVariables.settings.moneyFormat;let s=0;if(o){switch(o.type){case"$":s=100*o.amount;break;case"%":s=Math.floor(a*(o.amount/100))}const i=`
      <div class="row row--sm cart-discount mb-2">
        <div class="col-6">
          <p class="text-accent text-secondary">
            <span class="${window.themeVariables.settings.icon}" translate="no" aria-hidden="true">local_offer</span>

            ${o.name}
          </p>
        </div>

        <div class="col-6 text-end">
          <p class="text-accent text-secondary">-<span class="money">${theme.Currency.formatMoney(s,t)}</span></p>
        </div>
      </div>
    `;n.forEach(t=>{t.classList.contains("cart-discount--automated")?t.setAttribute("hidden","hidden"):t.remove()}),e.forEach(t=>{t.insertAdjacentHTML("beforebegin",i)}),document.dispatchEvent(new CustomEvent("theme:addon:custom-currencies:convert-prices"))}else n.forEach(t=>{t.classList.contains("cart-discount--automated")?t.setAttribute("hidden","hidden"):t.remove()});document.dispatchEvent(new CustomEvent("theme:cart-discount:saved"))}theme.isCartLoaded?e(theme.cart):document.addEventListener("theme:cart:initially-loaded",()=>{e(theme.cart)}),document.addEventListener("theme:cart:loaded",t=>{e(t.detail.cart)})};