!function(){const q={moneyFormat:window.themeVariables.settings.moneyFormat},_={addonSection:".dbtfy-quantity-breaks",cartBreak:".dbtfy-quantity-breaks__cart-break",productBreaksContainer:".dbtfy-quantity-breaks-container",productBreaks:".dbtfy-quantity-breaks__product-breaks",productBreak:".dbtfy-quantity-breaks__product-break",productSection:".product.section",productForm:".product__form",quantity:".dbtfy-quantity-breaks__quantity",productJSON:"[data-product-json]",masterSelect:"[data-product-master-select]"};function t(e){theme.helpers.loadComponents(["discountCode","visibility"],()=>{e()})}function a(){const b=document.querySelector(_.addonSection);if(b){var e=theme.helpers.safelyParseJson(b.dataset.sectionSettings);if(e){q.singleBreakText=e.singleBreakText,q.text=e.text,q.highestDiscountText=e.highestDiscountText,q.singleBreakPriceType=e.singleBreakPriceType;const v={add:function(t){var e=this.getStoredQuantityBreaks();e.length?e.some(e=>e.productId===t.productId)||(e.push(t),sessionStorage.setItem("breaks-discounts",JSON.stringify(e))):sessionStorage.setItem("breaks-discounts",JSON.stringify([t]))},getStoredQuantityBreaks:function(){var e=sessionStorage.getItem("breaks-discounts");return!e||"object"!=typeof(e=JSON.parse(e))?[]:e}};function t(){theme.isCartLoaded?a():document.addEventListener("theme:cart:initially-loaded",()=>{a()})}function a(){var e=theme.cart;if(e){var a=b.querySelectorAll(_.productBreaks),a=(a.length&&(a=`
        <div class="dbtfy-quantity-breaks-container">
          ${Array.from(a).reduce((e,t)=>{var a=t.querySelectorAll(_.productBreak);return a.length?(t=theme.helpers.safelyParseJson(t.dataset.blockSettings))?(a=Array.from(a).reduce((e,t)=>{t=theme.helpers.safelyParseJson(t.dataset.blockSettings);return t?e+`
            <div class="radio dbtfy-quantity-breaks__quantity">
              <input type="radio"
                     id="Quantity-break"
                     name="quantity"
                     value="${+t.range}"
                     data-discount-code="${t.discountCode}"
                     data-discount-type="${t.discountType}"
                     data-discount-amount="${+t.discountAmount}">

              <label for="Quantity-break">
                ${q.singleBreakText}
              </label>
            </div>
          `:""},""),e+`
          <div class="dbtfy-quantity-breaks__product-breaks"
               data-block-settings='${JSON.stringify(t)}'>

            <div class="radio dbtfy-quantity-breaks__quantity">
              <input type="radio"
                     id="Quantity-break"
                     name="quantity"
                     value="1">

              <label for="Quantity-break">
                ${q.singleBreakText}
              </label>
            </div>

            ${a}
          </div>
        `):void 0:e},"")}
        </div>
      `,b.insertAdjacentHTML("beforeend",a)),document.querySelectorAll(_.productSection));if(a.length){{var r=a;var o=theme.Visibility.sort(b,_.productBreaks);for(var[t,n]of o)n.forEach(e=>{var t=theme.helpers.safelyParseJson(e.dataset.blockSettings);if(t){const o={...t,template:e.cloneNode(!0)};r.forEach(n=>{var e=n.querySelector(_.productJSON),e=e?JSON.parse(e.innerHTML):null;e&&theme.Visibility.check(e,o,()=>{var e=n,t=o;if(e){e.querySelectorAll(_.productBreaks).forEach(e=>{e.remove()});var e=e.querySelector(".product__quantity"),a=e.querySelector(".product-quantity");for(e.querySelector("label").removeAttribute("hidden");a.firstChild;)a.removeChild(a.lastChild);var e=t.template.cloneNode(!0),t=document.body.classList.contains("template-product"),r=theme.helpers.safelyParseJson(e.dataset.blockSettings);r&&(!r.showOnProductPage&&t?a.setAttribute("hidden","hidden"):a.removeAttribute("hidden"),a.classList.add("dbtfy-quantity-breaks"),a.insertAdjacentElement("beforeend",e))}})})}});o=b.querySelector(q.productBreaksContainer);o&&o.remove()}{var o=document.querySelectorAll(_.productBreaks);o.forEach((e,r)=>{const n=e.closest(_.productSection);e.querySelectorAll(_.quantity).forEach((e,t)=>{var a=e.querySelector("label"),e=e.querySelector("input");a.setAttribute("for",e.id+`-${r}-`+t),e.setAttribute("id",e.id+`-${r}-`+t),n&&e.setAttribute("form","AddToCartForm--"+n.dataset.sectionId),0===t&&e.setAttribute("checked","checked")})})}if(document.body.classList.contains("template-product")){const d=document.querySelector(".dbtfy-sticky-addtocart__quantity input[name='quantity']");d&&(o=document.querySelector(".section.product"))&&(s=o.querySelectorAll(".dbtfy-quantity-breaks__quantity input[name='quantity']"),o=o.querySelector(".dbtfy-quantity-breaks__quantity input[name='quantity']:checked"),s.forEach(e=>{e.addEventListener("change",()=>{d.value=e.value})}),o)&&(d.value=o.value)}{var s=document.querySelectorAll("[data-product-option-selector]"),o=document.querySelectorAll(".product__form--no-variants");s.forEach(e=>{e.addEventListener("change",e=>{f(e)}),f({target:e})}),o.forEach(e=>{f({target:e})})}{o=a;o.length&&o.forEach(a=>{const r=a.querySelector(".product__form");r&&r.addEventListener("submit",()=>{var e,t;e=a,t=r,e&&t&&(t=+e.dataset.productId,e=e.querySelectorAll(_.quantity),e=Array.from(e).map(e=>{var e=e.querySelector("input"),t=+e.value,a=e.dataset.discountCode,r=e.dataset.discountType,e=+e.dataset.discountAmount;if(1!=t)return{breakCount:t,discount:{code:a,type:r,amount:e}}}).filter(e=>e),t={productId:t,breaks:e},v.add(t))})})}}{const y=theme.cart,m=v.getStoredQuantityBreaks();m.forEach(e=>{const a=e.productId;e=e.breaks;const r=y.items.reduce((e,t)=>t.product_id===a?e+t.quantity:e,0);var t=e.slice().reverse().find(e=>e.breakCount<=r),t=t?t.discount:null,n=theme.discountCode.getStoredDiscounts();const o=h(theme.discountCode.getMostValuableDiscount(n,y),y);n=h(t,y),t=y.total_price;const s=e.find(e=>{var t=h(e.discount,y);return e.breakCount>r&&t>o}),c=s?s.discount:null;e=h(c,y);let i=`
            <div class="dbtfy-quantity-breaks dbtfy-quantity-breaks__product-break">
                <div class="card text-center dbtfy-quantity-breaks__alert dbtfy-quantity-breaks__product-break-remains">
                    <div class="card__body card__body--xs">
                        <div class="dbtfy-quantity-breaks__text">
        `;function d(){return q.highestDiscountText?`<div>${q.highestDiscountText}</div>`:""}i=i+(0<e&&n<e&&e<=t?function(){let e="";var t=s.breakCount-r;let a=c.amount+"%";"$"===c.type&&(a=`<span class="money">${theme.Currency.formatMoney(100*c.amount,q.moneyFormat)}</span>`);q.text&&(e+=q.text.replaceAll("_COUNT_",`<strong class="text-secondary">${t}</strong>`).replaceAll("_DISCOUNT_AMOUNT_",`<strong class="text-secondary">${a}</strong>`));return e}:d)()+"</div></div></div></div>",y.items.forEach(e=>{e=e.product_id;e===a&&document.querySelectorAll(`.cart__row[data-product-id='${e}']`).forEach(e=>{var t=e.closest(".cart-drawer, .cart-modal");e.querySelectorAll(".dbtfy-quantity-breaks, .dbtfy-quantity-breaks__product-break").forEach(e=>{e.remove()}),e.insertAdjacentHTML("afterbegin",i),t&&(t=e.querySelector(".dbtfy-quantity-breaks__product-break"))&&t.classList.add("mb-3")})}),document.dispatchEvent(new CustomEvent("theme:addon:custom-currencies:convert-prices")),theme.discountCode.init()})}var u=e,a=b.querySelectorAll(_.cartBreak);if(a.length){const p=u.original_total_price;let d=u.item_count,r=document.createElement("div");o=document.createElement("div"),e=document.createElement("div");let n=document.createElement("div");r.classList.add("dbtfy-quantity-breaks","dbtfy-quantity-breaks--cart-break"),o.classList.add("card","text-center","dbtfy-quantity-breaks__alert"),e.classList.add("card__body","card__body--xs"),n.classList.add("dbtfy-quantity-breaks__text"),r.appendChild(o),e.appendChild(n),o.appendChild(e);o=Array.from(a).map(e=>{var t,a,r,e=theme.helpers.safelyParseJson(e.dataset.blockSettings);if(e)return t=+e.range,a=e.discountCode,r=+e.discountAmount,{name:a,type:e.discountType,amount:r,range:t}}),e=Array.from(o,e=>e.range).sort((e,t)=>e-t);let t=e.reduce((e,t)=>Math.abs(t-d)<Math.abs(e-d)?t:e);var c=t-d,i=o.find(e=>e.range===t);if(0===e.indexOf(t)&&d<t)l(i,c);else if(e.indexOf(t)===e.length-1)q.highestDiscountText&&(n.innerHTML=`<div>${q.highestDiscountText}</div>`);else{i=e.indexOf(t)+1;if(i){let t=e[i];c=o.find(e=>e.range===t);if(!t)return void(q.highestDiscountText&&(n.innerHTML=`<div>${q.highestDiscountText}</div>`));e=t-d;l(c,e)}}function l(e,t){let a;a="$"===e.type?`<span class="money">${theme.Currency.formatMoney(100*e.amount,q.moneyFormat)}</span>`:e.amount+"%",q.text&&(n.innerHTML=q.text.replaceAll("_COUNT_",`<strong class="text-secondary">${t}</strong>`).replaceAll("_DISCOUNT_AMOUNT_",`<strong class="text-secondary">${a}</strong>`))}a.forEach((e,t)=>{e=theme.helpers.safelyParseJson(e.dataset.blockSettings);if(e){var a=+e.range,r=e.discountCode,n=+e.discountAmount,o=e.discountType,s={name:r,type:o,amount:n},c=(0===d?theme.discountCode.removeAllDiscountsByName(r,{role:"cart-break",needUpdate:!1}):theme.discountCode.removeDiscount(r,{role:"cart-break",needUpdate:!1}),theme.discountCode.getStoredDiscounts()),c=h(theme.discountCode.getMostValuableDiscount(c,u),u),s=h(s,u);const i=e.giftWrapProductId;u.items.some(e=>e.product_id===i)&&d--,c<s&&s<=p&&d>=a&&theme.discountCode.addDiscount(r,o,n,{role:"cart-break"})}}),!function(){var e=document.querySelector("#CartDrawer .cart__total-price-info"),t=document.querySelector("#CartModal .cart__total-price-info"),e="drawer"===window.themeVariables.settings.cartType?e:t,t=document.querySelector(".cart__form .cart__total-price-info"),a=document.querySelector(".dbtfy-quantity-breaks__alert-drawer-wrapper");a&&a.remove();e&&!e.parentElement.querySelector(".dbtfy-quantity-breaks--cart-break")&&((a=r.querySelector(".dbtfy-quantity-breaks__text"))&&a.innerHTML&&e.insertAdjacentHTML("afterend",r.outerHTML),a=document.querySelector("#CartDrawer .dbtfy-quantity-breaks--cart-break"),e=document.querySelector("#CartModal .dbtfy-quantity-breaks--cart-break"),a="drawer"===window.themeVariables.settings.cartType?a:e)&&(e=a.querySelector(".dbtfy-quantity-breaks__alert"))&&""!==e.innerHTML.trim()&&a.classList.add("dbtfy-quantity-breaks__alert-drawer-wrapper");e=document.querySelector(".dbtfy-quantity-breaks__alert-wrapper");e&&e.remove();t&&!t.parentElement.querySelector(".dbtfy-quantity-breaks--cart-break")&&((a=r.querySelector(".dbtfy-quantity-breaks__text"))&&a.innerHTML&&t.insertAdjacentHTML("afterend",r.outerHTML),e=document.querySelector("#cartForm .dbtfy-quantity-breaks--cart-break"))&&(a=e.querySelector(".dbtfy-quantity-breaks__alert"))&&""!==a.innerHTML.trim()&&e.classList.add("dbtfy-quantity-breaks__alert-wrapper")}(),document.dispatchEvent(new CustomEvent("theme:addon:custom-currencies:convert-prices")),theme.discountCode.init()}}}function f(e){e=e.target.closest(_.productSection);if(e){var t=e.querySelector(_.masterSelect)?.querySelector("option:checked");const r=t?+t.value:null;t=e.querySelectorAll(_.quantity),e=e.querySelector(_.productJSON);if(e){const l=JSON.parse(e.innerHTML).variants.find(e=>e.id===r);function a(){document.querySelectorAll(_.productBreaks).forEach(e=>{var t=e.querySelectorAll(_.quantity),e=e.closest(_.productSection);if(e){var a=e.querySelector(_.masterSelect).querySelector("option:checked");const o=+a.value;var r,n,a=theme.helpers.safelyParseJson(a.dataset.variantSettings),e=e.querySelector(_.productJSON);e&&(e=JSON.parse(e.innerHTML).variants.find(e=>e.id===o))&&(n=theme.cart,r=a.inventoryQuantity||0,a=a.inventoryPolicy,n=n.items.reduce((e,t)=>t.id===o?e+t.quantity:e,0),e.available?"shopify"===e.inventory_management&&"continue"!==a?s(r-n,t):s(30,t):s(0,t))}})}function s(r,e){e.forEach(e=>{var t=e.querySelector("input"),a=+t.value;1==a&&(t.checked=!0),r<a||e.hasAttribute("data-invalid-value")?e.setAttribute("hidden","hidden"):e.removeAttribute("hidden")})}l&&(t.forEach(e=>{var t=e.querySelector("label"),a=e.querySelector("input"),r=+a.value,n=a.dataset.discountType,o=+a.dataset.discountAmount,s=!!q.singleBreakPriceType&&q.singleBreakPriceType.includes("single");let c=l.price,i=l.compare_at_price,d=q.singleBreakText,u="";if(d=d.replace("_COUNT_",r),1<r)switch(i=s?c:c*r,n){case"$":c=s?(u=`<span class="money">${theme.Currency.formatMoney(100*o/r,q.moneyFormat)}</span>`,i-100*o/r):(u=`<span class="money">${theme.Currency.formatMoney(100*o,q.moneyFormat)}</span>`,i-100*o);break;case"%":c=i-i/100*o,u=o+"%"}1<r&&!o||c<0||i<0?e.setAttribute("data-invalid-value","true"):e.removeAttribute("data-invalid-value"),d=i?d.replace("_PRICE_",`
            <span class="dbtfy-quantity-breaks__price text-accent">
              <span class="dbtfy-quantity-breaks__discounted-price on-sale text-sale" data-price="${c}">
                <span class="money">
                  ${theme.Currency.formatMoney(c,q.moneyFormat)}
                </span>
              </span>

              <span class="dbtfy-quantity-breaks__original-price text-strike text-muted" data-compare-price="${i}">
                <span class="money">
                  ${theme.Currency.formatMoney(i,q.moneyFormat)}
                </span>
              </span>
            </span>
          `):d.replace("_PRICE_",`
            <span class="dbtfy-quantity-breaks__price text-accent">
              <span class="money">
                ${theme.Currency.formatMoney(c,q.moneyFormat)}
              <span>
            </span>
          `),d=1<r?(a=window.themeVariables.strings.save.replace("{{ saved_amount }}",u),d.replace("_SAVED_AMOUNT_",`
            <span class="badge dbtfy-quantity-breaks__saved-amount">
              ${a}
            </span>
          `)):d.replace("_SAVED_AMOUNT_",""),t.innerHTML=d}),theme.isCartLoaded?a():document.addEventListener("theme:cart:initially-loaded",a),document.dispatchEvent(new CustomEvent("theme:addon:custom-currencies:convert-prices")))}}}function h(e,t,a){var r=a||t.items_subtotal_price;let n=0;if(e)switch(e.type){case"$":n=100*e.amount;break;case"%":n=r*(e.amount/100)}return n}t(),document.addEventListener("theme:addon:upsell-popup:loaded",()=>{t()}),document.addEventListener("theme:cart:loaded",e=>{t()}),setTimeout(()=>{document.querySelectorAll("[data-testid]").forEach(s=>{const c=s.closest(_.productSection);c&&c.querySelector(_.productBreaks)&&s.addEventListener("click",e=>{e.preventDefault(),e.stopPropagation();var e=c.querySelectorAll(_.quantity),t=c.querySelector(_.masterSelect)?.querySelector("option:checked");const a=t?+t.value:null;let r="";e.forEach(e=>{e=e.querySelector("input:checked");e&&(r={variantID:a,quantity:+e.value,discountCode:e.dataset.discountCode,discountType:e.dataset.discountType,discountAmount:e.dataset.discountAmount})});var n=s,t=r;if(t){let r=`${window.location.origin}/cart/${t.variantID}:${t.quantity}?locale=`+Shopify.locale;const o=n.dataset.testid.toLowerCase();["amazon","apple","google","paypal","shop","venmo"].forEach(e=>{let t=!1;var a;(t=o.includes(e)||(a=n.querySelector("[role='button']"))&&a.dataset.testid.toLowerCase().includes(e)?!0:t)&&(a=e+"_pay",r=r+"&payment="+a)}),window.location.assign(r)}},!0)})},1e3)}}}document.body.classList.add("dbtfy-quantity-breaks-enabled"),t(()=>{a()}),document.addEventListener("shopify:section:load",e=>{t(()=>{a()})}),document.addEventListener("theme:discount:applied",e=>{t(()=>{a()})})}();